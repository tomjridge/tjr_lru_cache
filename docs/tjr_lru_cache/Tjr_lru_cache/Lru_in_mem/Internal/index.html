<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Internal (tjr_lru_cache.Tjr_lru_cache.Lru_in_mem.Internal)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">tjr_lru_cache</a> &#x00BB; <a href="../../index.html">Tjr_lru_cache</a> &#x00BB; <a href="../index.html">Lru_in_mem</a> &#x00BB; Internal</nav><h1>Module <code>Lru_in_mem.Internal</code></h1></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></li></ul><h3 class="heading">Signature</h3><div class="spec module" id="module-L"><a href="#module-L" class="anchor"></a><code><span class="keyword">module</span> <a href="L/index.html">L</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-lru"><a href="#type-lru" class="anchor"></a><code><span class="keyword">type</span> lru</code><code> = <a href="L/index.html#type-t">L.t</a></code></dt></dl><dl><dt class="spec value" id="val-find_in_cache"><a href="#val-find_in_cache" class="anchor"></a><code><span class="keyword">val</span> find_in_cache : <a href="argument-1-S/index.html#type-k">S.k</a> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span> <span>&#45;&gt;</span> <span><a href="L/index.html#type-v">L.v</a> option</span> * <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span></code></dt><dd><p>Attempt to locate key in cache. FIXME inline</p></dd></dl><dl><dt class="spec exception" id="exception-E_"><a href="#exception-E_" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">E_</span></code></dt><dd><p>An exception, for quick abort. FIXME remove</p></dd></dl><dl><dt class="spec value" id="val-make_cached_map"><a href="#val-make_cached_map" class="anchor"></a><code><span class="keyword">val</span> make_cached_map : unit <span>&#45;&gt;</span> <span>(<a href="argument-1-S/index.html#type-k">S.k</a> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span> <span>&#45;&gt;</span> <span><span>(<a href="L/index.html#type-v">L.v</a>, <span>vopt_from_lower:<span><a href="argument-1-S/index.html#type-v">S.v</a> option</span></span> <span>&#45;&gt;</span> <span>lim_state:<span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span></span> <span>&#45;&gt;</span> <span><a href="argument-1-S/index.html#type-v">S.v</a> option</span> * <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-evictees_x_lim_state">Im_intf.evictees_x_lim_state</a></span>)</span> <a href="../../Im_intf/index.html#type-maybe_in_cache">Im_intf.maybe_in_cache</a></span>)</span> * <span>(<a href="L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <a href="argument-1-S/index.html#type-v">S.v</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <a href="L/index.html#type-t">L.t</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-evictees_x_lim_state">Im_intf.evictees_x_lim_state</a></span>)</span> * <span>(<a href="L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>, <a href="L/index.html#type-t">L.t</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-evictees_x_lim_state">Im_intf.evictees_x_lim_state</a></span>)</span> * <span>(<a href="L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-S/index.html#type-k">S.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span> <span>&#45;&gt;</span> <span><span>(<a href="L/index.html#type-v">L.v</a> * <span><span>(<span class="type-var">'e</span>, <span class="type-var">'f</span>, <a href="L/index.html#type-t">L.t</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span>, unit)</span> <a href="../../Im_intf/index.html#type-maybe_in_cache">Im_intf.maybe_in_cache</a></span>)</span></code></dt><dd><p>Construct the cached map, using existing map find operation.</p><p>NOTE the idea for <code>find</code> is that we execute a quick step to handle the case that there is an entry in the cache. If there isn't, we make a slow call to the lower layer, and when the result arrives we make another update to the cache state with the then current state of the cache. To avoid the risk of stale results being returned from lower, we have to tag lower results with some kind of monotonically-increasing index.</p></dd></dl><dl><dt class="spec value" id="val-make_lru_in_mem"><a href="#val-make_lru_in_mem" class="anchor"></a><code><span class="keyword">val</span> make_lru_in_mem : unit <span>&#45;&gt;</span> <span><span>(<a href="L/index.html#type-k">L.k</a>, <a href="argument-1-S/index.html#type-v">S.v</a>, <a href="index.html#type-lru">lru</a>)</span> <a href="../../Im_intf/index.html#type-lim_ops">Im_intf.lim_ops</a></span></code></dt><dd><p>Package up the operations in a record</p></dd></dl><dl><dt class="spec value" id="val-make_init_lim_state"><a href="#val-make_init_lim_state" class="anchor"></a><code><span class="keyword">val</span> make_init_lim_state : <span>max_size:int</span> <span>&#45;&gt;</span> <span>evict_count:int</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <a href="L/index.html#type-t">L.t</a>)</span> <a href="../../Im_intf/index.html#type-lim_state">Im_intf.lim_state</a></span></code></dt></dl></div></body></html>