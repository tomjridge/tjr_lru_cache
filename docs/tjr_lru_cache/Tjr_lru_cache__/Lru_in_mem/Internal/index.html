<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Internal (tjr_lru_cache.Tjr_lru_cache__.Lru_in_mem.Internal)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">tjr_lru_cache</a> &#x00BB; <a href="../../index.html">Tjr_lru_cache__</a> &#x00BB; <a href="../index.html">Lru_in_mem</a> &#x00BB; Internal</nav><h1>Module <code>Lru_in_mem.Internal</code></h1></header><dl><dt class="spec value" id="val-test"><a href="#val-test" class="anchor"></a><code><span class="keyword">val</span> test : (unit <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>FIXME tests are enabled; disable for production</p></dd></dl><dl><dt class="spec value" id="val-tick"><a href="#val-tick" class="anchor"></a><code><span class="keyword">val</span> tick : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a></code></dt><dt class="spec value" id="val-find_in_cache"><a href="#val-find_in_cache" class="anchor"></a><code><span class="keyword">val</span> find_in_cache : update_time:bool <span>&#45;&gt;</span> <span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> <span class="type-var">'v</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a> option * (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a></code></dt><dd><p>Attempt to locate key in cache.</p></dd></dl><dl><dt class="spec exception" id="exception-E_"><a href="#exception-E_" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">E_</span></code></dt><dd><p>An exception, for quick abort. FIXME remove</p></dd></dl><dl><dt class="spec value" id="val-make_cached_map"><a href="#val-make_cached_map" class="anchor"></a><code><span class="keyword">val</span> make_cached_map : unit <span>&#45;&gt;</span> (find:(<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'a</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> [&gt; `In_cache of <span class="type-var">'a</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a> | `Not_in_cache of vopt_from_lower:<span class="type-var">'a</span> option <span>&#45;&gt;</span> cache_state:(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option * [&gt; `Evictees of (<span class="type-var">'k</span> * <span class="type-var">'v</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a>) list option ] * [&gt; `Cache_state of (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> ] ]) <span>&#45;&gt;</span> insert:(<span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'v</span> <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> [&gt; `Evictees of (<span class="type-var">'k</span> * <span class="type-var">'v</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a>) list option ] * [&gt; `Cache_state of (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> ]) <span>&#45;&gt;</span> delete:(<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> [&gt; `Evictees of (<span class="type-var">'k</span> * <span class="type-var">'v</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a>) list option ] * [&gt; `Cache_state of (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'k_map</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> ]) <span>&#45;&gt;</span> sync_key:(<span class="type-var">'b</span> <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> <span>&#45;&gt;</span> [&gt; `Not_present | `Present of <span class="type-var">'c</span> <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-entry">Tjr_lru_cache.Im_intf.entry</a> * (<span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../../../Tjr_lru_cache/Im_intf/index.html#type-cache_state">Tjr_lru_cache.Im_intf.cache_state</a> ]) <span>&#45;&gt;</span> <span class="type-var">'e</span>) <span>&#45;&gt;</span> <span class="type-var">'e</span></code></dt><dd><p>Construct the cached map on top of an existing map.</p><p>NOTE the idea for <code>find</code> is that we execute a quick step to handle the case that there is an entry in the cache. If there isn't, we make a slow call to the lower layer, and when the result arrives we make another update to the cache state with the then current state of the cache. To avoid the risk of stale results being returned from lower, we have to tag lower results with some kind of monotonically-increasing index.</p></dd></dl><dl><dt class="spec value" id="val-make_lru_in_mem"><a href="#val-make_lru_in_mem" class="anchor"></a><code><span class="keyword">val</span> make_lru_in_mem : unit <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../../../Tjr_lru_cache/Im_intf/Lru_in_mem_ops/index.html#type-lru_in_mem_ops">Tjr_lru_cache.Im_intf.Lru_in_mem_ops.lru_in_mem_ops</a></code></dt><dd><p>Package up the operations in a record</p></dd></dl></div></body></html>